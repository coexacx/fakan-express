<%- include('../partials/header', { title, admin, flash }) %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 m-0 admin-title">商品管理</h1>
  <a class="btn btn-sm btn-success" href="/admin/products/new">新增商品</a>
</div>

<div class="table-responsive">
  <table class="table table-sm align-middle admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>名称</th>
        <th>价格</th>
        <th>上架</th>
        <th>库存(可用/预留/已售)</th>
        <th class="text-end">操作</th>
      </tr>
    </thead>
    <tbody>
    <% if (!products || products.length === 0) { %>
      <tr><td colspan="6" class="text-muted admin-muted">暂无商品</td></tr>
    <% } %>

    <% products.forEach(p => { %>
      <tr>
        <td><%= p.id %></td>
        <td><%= p.name %></td>
        <td>￥<%= formatMoney(p.price_cents) %></td>
        <td>
          <% if (p.is_active) { %>
            <span class="badge text-bg-success">是</span>
          <% } else { %>
            <span class="badge text-bg-secondary">否</span>
          <% } %>
        </td>
        <td>
          <span class="badge text-bg-secondary"><%= p.available_count %></span>
          /
          <span class="badge text-bg-warning"><%= p.reserved_count %></span>
          /
          <span class="badge text-bg-success"><%= p.sold_count %></span>
        </td>
        <td class="text-end admin-actions">
          <a class="btn btn-sm btn-outline-primary" href="/admin/products/<%= p.id %>/inventory">库存</a>
          <a class="btn btn-sm btn-outline-secondary" href="/admin/products/<%= p.id %>/edit">编辑</a>
          <form method="post" action="/admin/products/<%= p.id %>/delete" class="d-inline" onsubmit="return confirm('确定删除该商品？（若存在库存或订单引用会删除失败）')">
            <button class="btn btn-sm btn-outline-danger" type="submit">删除</button>
          </form>
        </td>
      </tr>
    <% }) %>
    </tbody>
  </table>
</div>

<%- include('../partials/footer') %>
