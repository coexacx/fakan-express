<%- include('../partials/header', { title, admin, flash }) %>

<div class="admin-page-header">
  <h1 class="h5 admin-title">订单管理</h1>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 m-0 admin-title">订单管理</h1>
  <a class="btn btn-sm btn-outline-secondary" href="/admin">返回后台</a>
</div>

<form class="row g-2 mb-3 admin-form" method="get" action="/admin/orders">
  <div class="col-auto">
    <select class="form-select form-select-sm" name="status">
      <option value="" <%= !status ? 'selected' : '' %>>全部</option>
      <option value="pending" <%= status==='pending' ? 'selected' : '' %>>pending</option>
      <option value="paid" <%= status==='paid' ? 'selected' : '' %>>paid</option>
      <option value="delivered" <%= status==='delivered' ? 'selected' : '' %>>delivered</option>
      <option value="delivery_failed" <%= status==='delivery_failed' ? 'selected' : '' %>>delivery_failed</option>
      <option value="expired" <%= status==='expired' ? 'selected' : '' %>>expired</option>
      <option value="canceled" <%= status==='canceled' ? 'selected' : '' %>>canceled</option>
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-sm btn-primary" type="submit">筛选</button>
  </div>
</form>

<div class="admin-section table-responsive">
  <table class="table table-sm align-middle admin-table mb-0">
<div class="table-responsive">
  <table class="table table-sm align-middle admin-table">
    <thead>
      <tr>
        <th>订单号</th>
        <th>状态</th>
        <th>金额</th>
        <th>数量</th>
        <th>联系方式</th>
        <th>下单时间</th>
        <th class="text-end">操作</th>
      </tr>
    </thead>
    <tbody>
    <% if (!orders || orders.length === 0) { %>
      <tr><td colspan="7" class="text-muted admin-muted">暂无订单</td></tr>
    <% } %>
    <% orders.forEach(o => { %>
      <tr>
        <td><code><%= o.order_no %></code></td>
        <td><span class="badge text-bg-secondary"><%= o.status %></span></td>
        <td>￥<%= formatMoney(o.total_cents) %></td>
        <td><%= o.total_qty || 0 %></td>
        <td><%= o.customer_contact %></td>
        <td class="small text-muted"><%= new Date(o.created_at).toLocaleString() %></td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-primary" href="/admin/orders/<%= o.order_no %>">详情</a>
        </td>
      </tr>
    <% }) %>
    </tbody>
  </table>
</div>

<%- include('../partials/footer') %>
