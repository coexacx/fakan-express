<%- include('../partials/header', { title, admin, flash }) %>

<div class="admin-page-header">
  <div>
    <h1 class="admin-title">订单管理</h1>
    <div class="admin-subtitle">筛选并查看订单</div>
  </div>
  <a class="btn small" href="/admin">返回后台</a>
</div>

<form class="admin-filters" method="get" action="/admin/orders">
  <div class="field">
    <label class="label">状态</label>
    <select class="input" name="status">
      <option value="" <%= !status ? 'selected' : '' %>>全部</option>
      <option value="pending" <%= status==='pending' ? 'selected' : '' %>>pending</option>
      <option value="paid" <%= status==='paid' ? 'selected' : '' %>>paid</option>
      <option value="delivered" <%= status==='delivered' ? 'selected' : '' %>>delivered</option>
      <option value="delivery_failed" <%= status==='delivery_failed' ? 'selected' : '' %>>delivery_failed</option>
      <option value="expired" <%= status==='expired' ? 'selected' : '' %>>expired</option>
      <option value="canceled" <%= status==='canceled' ? 'selected' : '' %>>canceled</option>
    </select>
  </div>
  <div class="btnrow">
    <button class="btn primary" type="submit">筛选</button>
  </div>
</form>

<div class="card admin-section">
  <table class="table admin-table">
    <thead>
      <tr>
        <th>订单号</th>
        <th>状态</th>
        <th>金额</th>
        <th>数量</th>
        <th>联系方式</th>
        <th>下单时间</th>
        <th class="text-right">操作</th>
      </tr>
    </thead>
    <tbody>
    <% if (!orders || orders.length === 0) { %>
      <tr><td colspan="7" class="table-note">暂无订单</td></tr>
    <% } %>
    <% orders.forEach(o => { %>
      <tr>
        <td><code><%= o.order_no %></code></td>
        <td><span class="pill info"><%= o.status %></span></td>
        <td>￥<%= formatMoney(o.total_cents) %></td>
        <td><%= o.total_qty || 0 %></td>
        <td><%= o.customer_contact %></td>
        <td class="muted"><%= new Date(o.created_at).toLocaleString() %></td>
        <td class="text-right">
          <a class="btn small" href="/admin/orders/<%= o.order_no %>">详情</a>
        </td>
      </tr>
    <% }) %>
    </tbody>
  </table>
</div>

<%- include('../partials/footer') %>
