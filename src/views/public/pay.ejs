<%- include('../partials/public_header', { title, admin, flash }) %>
<% const o = data.order; %>

<section class="card">
  <div class="card-top">
    <div class="card-title">支付</div>
  </div>

  <div class="desc" style="margin-top:10px;">
    订单号：<strong><%= o.order_no %></strong> · 金额：<strong>￥<%= formatMoney(o.total_cents) %></strong>
  </div>

  <% if (!paymentReady) { %>
    <div class="alert alert-warning" style="margin-top:14px;">
      支付通道暂未配置，请联系商家处理或稍后再试。
    </div>
  <% } else if (!paymentMethods || paymentMethods.length === 0) { %>
    <div class="alert alert-warning" style="margin-top:14px;">
      暂时无法获取可用支付方式，请稍后再试或联系商家。
    </div>
  <% } else { %>
    <div class="help" style="margin-top:14px;">请选择支付方式，系统将跳转至对应支付平台完成付款。</div>
    <div class="btnrow" style="margin-top:12px;">
      <% paymentMethods.forEach(method => { %>
        <form method="post" action="/pay/<%= encodeURIComponent(o.order_no) %>/<%= encodeURIComponent(o.access_token) %>" class="inline-form">
          <input type="hidden" name="type" value="<%= method.type %>">
          <button class="btn primary" type="submit"><%= method.label %>支付</button>
        </form>
      <% }) %>
    </div>
  <% } %>

  <div class="btnrow" style="margin-top:12px;">
    <a class="btn" href="/order/<%= encodeURIComponent(o.order_no) %>/<%= encodeURIComponent(o.access_token) %>">返回订单</a>
  </div>
</section>

<%- include('../partials/public_footer') %>
